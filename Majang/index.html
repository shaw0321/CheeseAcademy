<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<script src="js/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="css/reset.css">

<link rel="stylesheet" href="css/sample.css">

<title>MIL(Majang I~~~ League)</title>
</head>
<body>

<header>
  <h1 class="title">MIL(Majang I~~~ League)</h1>
</header>

<main>
  <section class="charge_area">
  
    <p class="point_area title">ポイント残高: <span class="value">500</span>P<span class="alert title" style ="display: none;">←課金してチャージしてね</span></p>
    <!-- <p class = "btn"><label class="open" for="pop-up">課金</label></p> -->
    <label class="open btn" for="pop-up">課金</label>
  </section>
  <section class="player">
    <div class="player1">
      <h1 class= "title">プレイヤー：三菱太郎</h1>
      <UL class="haipai">
        <li id=1><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=2><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=3><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=4><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=5><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=6><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=7><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=8><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=9><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=10><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=11><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=12><img src="./img/pai-images/ji6-66-90-l-emb.png"></li>
        <li id=13 class="rightend"><img src="./img/pai-images/ji6-66-90-l-emb.png" ></li>
        <li id=14><img src="./img/pai-images/ji6-66-90-l-emb.png" class="selected"></li>
    </UL>
    </div>
  </section>

 
  <section>
    <!-- ボタンとかを書く領域 -->
    <div>
      <ul class="btns">
        <li class="btn haipai_btn">配牌</li>
        <li class="btn sorting_btn">理牌</li>
        <!-- <li class="btn tenho">天和判定</li> -->
      </ul>
    </div>
  </section>

  <!-- 課金画面に関する記述 -->
<input type="checkbox" id="pop-up">
<div class="overlay">
	<div class="window">
		<label class="close title" for="pop-up">×</label>
		<p class="text title">料金表</p>
    <div>
      <ul class="tariff"> 
        <li>
          <p class="tariff_left">100P</p>
          <p class ="tariff_right btn charge100" value="100">100<span>円</span></p>
        </li>
        <li>
          <p class="tariff_left">1000P</p>
          <p class ="tariff_right btn charge1000" value="1000">500<span>円</span></p>
        </li>
        <li>
          <p class="tariff_left">5000P</p>
          <p class ="tariff_right btn charge5000" value="5000">じゃんけん</p>
        </li>
      </ul>


    </div>
	</div>
</div>

<section class="backlog">
  <p class= "title">Product Backlog</p>
  <ul>
    <li>完了：配牌ボタンを押すと牌が表示される</li>
    <li>完了：理牌ボタンを押したとき、自摸牌を除き牌が所定のルールに従ってソートされる</li>
    <li>未完了：天和判定をして、天和だった場合エフェクトを表示する</li>
    <li>完了：牌をクリックすると、選択モードになり画像がtop:-20pxになる</li>
    <li>未完了：選択モードの牌を再度クリックすると捨牌とする</li>
    <li>未完了：捨牌が発生した場合、再度理牌を行い、左から14番目に新しい牌を自摸する</li>
    <li>完了：ポイント残高を表示し、ポイント残高が０未満になる場合課金アラートを出す</li>
    <li>完了：配牌一回につき100P消費する</li>
    <li>未完了：自摸一回につき10P消費する</li>
    <li>完了：課金ボタンを押すと、課金画面が表示される</li>
    <li>完了：課金画面で金額ボタンを押すと、当該ポイントがチャージされ、課金画面が消える</li>
    <li>未完了；じゃんけんに勝つとポイントがもらえる</li>
    <li>未完了：デザインをどうにかする</li>
    <li>未完了：ネーミングをどうにかする</li>
    
  </ul>
</section>
  
</main>
<footer class="title">MIL(Majang I~~~ League)</footer>

<script>
  const hai = [0,"man1","man2","man3","man4","man5","man6","man7","man8","man9","pin1","pin2","pin3","pin4","pin5","pin6","pin7","pin8","pin9","sou1","sou2","sou3","sou4","sou5","sou6","sou7","sou8","sou9","ji1","ji2","ji3","ji4","ji5","ji6","ji7"];
 
  // 配牌と自摸の消費ポイント
  const haipai_point = 100;
  const tsumo_point = 100;

  let haipai =[];

  // 配牌のインデックスを選択する関数
  function HAIPAI(Array, yama, width, buttom){
    // 配牌を初期化
     Array =[];
    for(let i =0; i < 14; ){
      let hai_num = Math.ceil(width*Math.random()+buttom) ;
      if(yama[hai_num] > 0){
        Array.push(hai_num);
        yama[hai_num] = yama[hai_num] - 1;
        // console.log(yama);
        // console.log(Array);

        i++;
      };
     };
  
     return Array;
    };

    
  // 配牌インデックスを並び変える関数
  function compareFunc(a, b) {
  return a - b;
  };

  // 配牌を表示する関数 n=表示する牌の始点、m=表示する牌の終点
  function DISPLAY(number,Array2,n,m){
    for(let j =n; j <= m;j++){
        // console.log();
      $(".player" + number).find("#" + j).children('img').attr("src", "./img/pai-images/" +hai[Array2[j-1]] + "-66-90-l-emb.png");
    };
    // for(let j =1; j <= 14;j++){
    //     // console.log();
    //   $(".player" + number).find("#" + j).children('img').fadeIn(j*100);
    // };

  }

  // 捨て牌より右の牌を左に寄せる関数
  // heipaiの捨て牌id-1番目の要素を削除する
  // 13牌で表示する
  // 残りの山から積もってhaipai[13]に格納する
  // 14はい目を表示する




  // 残高確認を行う
  function checkAccount(amount){
    let value = Number($(".value").text());
    console.log(amount);
    console.log(value);


    if(amount > value){
      // 残高不足の時の処理を書く
      $(".alert").show();
      
    }else{
      // 残高が十分な時の処理を書く
      $(".value").text(value - amount);
    };

  }



  //配牌に関する記述を行う
  $('.haipai_btn').on("click",function(){
    let value = Number($(".value").text());
    
    if(haipai_point > value){
      // 残高不足の時の処理を書く
      $(".alert").show();
      
    }else{
      // 残高が十分な時の処理を書く
      // 配牌ボタンを押すたびに山を元に戻す
      let yama= [0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4];
      // このようにhaipaiに再代入しないと、初期に定義した[]状態の値を参照してしまう。
      haipai = HAIPAI(haipai, yama, 34, 0);  
      DISPLAY(1,haipai,1,14);

      // 残高をマイナスする
      $(".value").text(value - haipai_point);
    };
    
  });

// 理牌に関する記述を行う
$('.sorting_btn').on("click",function(){
    
    //  理牌ボタンを押したときにhaipaiの1~13までをソートする、14番目は残す
    var newArray =  haipai.slice(0,13);
    var fourteenth = haipai.slice(13,14);
    newArray.sort(compareFunc)

    haipai = newArray.concat(fourteenth);
 
    DISPLAY(1,haipai,1,14);
    
  });

// 牌を選択状態にする

$('.haipai img').not(".selected").on("click",function(){
    
  $(".haipai").find(".selected").removeClass("selected");

  $(this).attr("class", "selected");

  console.log("select");

  });

// 牌を捨てる
$('.haipai .selected').on("click",function(){
    
    // $(this).hide();
    console.log("hidden");
  
    });

// 課金処理
$('.charge100').on("click",function(){
   let add_point = 100;
  
  // thisのバリューを取得して、残高に追加する
  $(".value").text(Number($(".value").text()) + add_point);
  
  // アラートをけす
  $(".alert").hide();
    
    
    });

$('.charge1000').on("click",function(){
   let add_point = 1000;
  
  // thisのバリューを取得して、残高に追加する
  $(".value").text(Number($(".value").text()) + add_point);
  
  // アラートをけす
  $(".alert").hide();
    
    
    });

$('.charge5000').on("click",function(){

  alert("未実装です");
    });    
  
</script>
</body>
</html>
